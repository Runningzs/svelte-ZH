import{S as e,i as n,s as t,e as s,B as a,j as o,c as r,a as l,C as i,d as c,l as d,b as m,N as u,g as p,h as f,D as h,n as g,O as v,y as $,H as w,f as _,X as b,m as k,u as y,p as z,v as j,t as E,q as x,a4 as T,V as S,R as U,k as O,L as N,o as L,T as A,Q as I,a0 as D,a1 as P}from"./index.502c1ca4.js";import"./index.1637ca2d.js";import{a as R,g as M}from"./app.5d951216.js";import{b as B}from"./index.5bd105b7.js";import{R as C}from"./Repl.50b672fa.js";import{I as J}from"./InputOutputToggle.88fb3254.js";function V(e){var n,t,h,g,v,$,w;return{c(){n=s("div"),t=s("a"),h=a("Your saved apps"),g=o(),v=s("button"),$=a("Log out"),this.h()},l(e){n=r(e,"DIV",{class:!0},!1);var s=l(n);t=r(s,"A",{href:!0,class:!0},!1);var a=l(t);h=i(a,"Your saved apps"),a.forEach(c),g=d(s),v=r(s,"BUTTON",{class:!0},!1);var o=l(v);$=i(o,"Log out"),o.forEach(c),s.forEach(c),this.h()},h(){m(t,"href","apps"),m(t,"class","svelte-1741g67"),m(v,"class","svelte-1741g67"),m(n,"class","menu svelte-1741g67"),w=u(v,"click",e.logout)},m(e,s){p(e,n,s),f(n,t),f(t,h),f(n,g),f(n,v),f(v,$)},d(e){e&&c(n),w()}}}function F(e){var n,t,$,w,_,b,k,y,z,j=e.showMenu&&V(e);return{c(){n=s("div"),t=s("span"),$=a(e.name),w=o(),_=s("img"),y=o(),j&&j.c(),this.h()},l(s){n=r(s,"DIV",{class:!0},!1);var a=l(n);t=r(a,"SPAN",{class:!0},!1);var o=l(t);$=i(o,e.name),o.forEach(c),w=d(a),_=r(a,"IMG",{alt:!0,src:!0,class:!0},!1),l(_).forEach(c),y=d(a),j&&j.l(a),a.forEach(c),this.h()},h(){m(t,"class","svelte-1741g67"),m(_,"alt",b=e.name+" avatar"),m(_,"src",k=e.$session.user.avatar),m(_,"class","svelte-1741g67"),m(n,"class","user svelte-1741g67"),z=[u(n,"mouseenter",e.mouseenter_handler),u(n,"mouseleave",e.mouseleave_handler)]},m(e,s){p(e,n,s),f(n,t),f(t,$),f(n,w),f(n,_),f(n,y),j&&j.m(n,null)},p(e,t){e.name&&h($,t.name),e.name&&b!==(b=t.name+" avatar")&&m(_,"alt",b),e.$session&&k!==(k=t.$session.user.avatar)&&m(_,"src",k),t.showMenu?j||((j=V(t)).c(),j.m(n,null)):j&&(j.d(1),j=null)},i:g,o:g,d(e){e&&c(n),j&&j.d(),v(z)}}}function K(e,n,t){let s;const{session:a}=R();$(e,a,e=>{t("$session",s=e)});const{logout:o}=w("app");let r,l=!1;return e.$$.update=(e={$session:1})=>{e.$session&&t("name",r=s.user.name||s.user.username)},{session:a,logout:o,showMenu:l,name:r,$session:s,mouseenter_handler:()=>t("showMenu",l=!0),mouseleave_handler:()=>t("showMenu",l=!1)}}class H extends e{constructor(e){super(),n(this,e,K,F,t,[])}}const q=[];for(let e=0;e<256;e++){let n=e;for(let e=0;e<8;e++)n=1&n?3988292384^n>>>1:n>>>1;q[e]=n}var G=e=>{let n=-1;for(const t of e)n=n>>>8^q[255&(n^t)];return-1^n};const W=(e,n)=>{const t=[];for(;n--;)t.push(255&e),e>>>=8;return t},X=e=>"string"==typeof e?[...e].map(e=>e.charCodeAt(0)):e;var Y=e=>{let n=[];const t=[];for(const{path:s,data:a}of e){const e=X(a),o=X(s),r=[10,0,0,0,0,0,0,0,0,0,...W(G(e),4),...W(e.length,4),...W(e.length,4),...W(o.length,2),0,0];t.push(80,75,1,2,20,0,...r,0,0,0,0,0,0,0,0,0,0,...W(n.length,4),...o),n=[...n,80,75,3,4,...r,...o,...e]}return[...n,...t,80,75,5,6,0,0,0,0,...W(e.length,2),...W(e.length,2),...W(t.length,4),...W(n.length,4),0,0]},Q=e=>new Blob([Uint8Array.from(Y(e))],{type:"application/zip"}),Z=(e,n)=>{const t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=n,s.style.display="none",document.body.appendChild(s),s.click(),URL.revokeObjectURL(t),s.remove()};const ee=(ne=13,function(e,n){function t(e){e.keyCode===ne&&n.call(this,e)}return e.addEventListener("keydown",t),{destroy(){e.removeEventListener("keydown",t)}}});var ne;const te="undefined"!=typeof navigator&&"MacIntel"===navigator.platform;function se(e){var n,t=new B({props:{name:"maximize"}});return{c(){t.$$.fragment.c()},l(e){t.$$.fragment.l(e)},m(e,s){k(t,e,s),n=!0},i(e){n||(E(t.$$.fragment,e),n=!0)},o(e){z(t.$$.fragment,e),n=!1},d(e){x(t,e)}}}function ae(e){var n,t=new B({props:{name:"close"}});return{c(){t.$$.fragment.c()},l(e){t.$$.fragment.l(e)},m(e,s){k(t,e,s),n=!0},i(e){n||(E(t.$$.fragment,e),n=!0)},o(e){z(t.$$.fragment,e),n=!1},d(e){x(t,e)}}}function oe(e){var n,t=new B({props:{name:"git-branch"}});return{c(){t.$$.fragment.c()},l(e){t.$$.fragment.l(e)},m(e,s){k(t,e,s),n=!0},i(e){n||(E(t.$$.fragment,e),n=!0)},o(e){z(t.$$.fragment,e),n=!1},d(e){x(t,e)}}}function re(e){var n,t=new B({props:{name:"check"}});return{c(){t.$$.fragment.c()},l(e){t.$$.fragment.l(e)},m(e,s){k(t,e,s),n=!0},i(e){n||(E(t.$$.fragment,e),n=!0)},o(e){z(t.$$.fragment,e),n=!1},d(e){x(t,e)}}}function le(e){var n,t=new B({props:{name:"save"}});return{c(){t.$$.fragment.c()},l(e){t.$$.fragment.l(e)},m(e,s){k(t,e,s),n=!0},i(e){n||(E(t.$$.fragment,e),n=!0)},o(e){z(t.$$.fragment,e),n=!1},d(e){x(t,e)}}}function ie(e){var n,t=new B({props:{name:"check"}});return{c(){t.$$.fragment.c()},l(e){t.$$.fragment.l(e)},m(e,s){k(t,e,s),n=!0},i(e){n||(E(t.$$.fragment,e),n=!0)},o(e){z(t.$$.fragment,e),n=!1},d(e){x(t,e)}}}function ce(e){var n,t,h,g,v,$,w=new B({props:{name:"log-in"}});return{c(){n=s("button"),w.$$.fragment.c(),t=o(),h=s("span"),g=a(" Log in to save"),this.h()},l(e){n=r(e,"BUTTON",{class:!0},!1);var s=l(n);w.$$.fragment.l(s),t=d(s),h=r(s,"SPAN",{class:!0},!1);var a=l(h);g=i(a," Log in to save"),a.forEach(c),s.forEach(c),this.h()},h(){m(h,"class","svelte-1ez15pl"),m(n,"class","icon svelte-1ez15pl"),$=u(n,"click",T(e.login))},m(e,s){p(e,n,s),k(w,n,null),f(n,t),f(n,h),f(h,g),v=!0},i(e){v||(E(w.$$.fragment,e),v=!0)},o(e){z(w.$$.fragment,e),v=!1},d(e){e&&c(n),x(w),$()}}}function de(e){var n,t=new H({});return{c(){t.$$.fragment.c()},l(e){t.$$.fragment.l(e)},m(e,s){k(t,e,s),n=!0},i(e){n||(E(t.$$.fragment,e),n=!0)},o(e){z(t.$$.fragment,e),n=!1},d(e){x(t,e)}}}function me(e){var n,t,a,i,h,g,$,w,T,S,U,O,N,L,A,I,D,P,R,M,C,J,V,F,K,H=[ae,se],q=[];function G(e,n){return n.zen_mode?0:1}$=G(0,e),w=q[$]=H[$](e);var W=new B({props:{name:"download"}}),X=[re,oe],Y=[];function Q(e,n){return n.justForked?0:1}N=Q(0,e),L=Y[N]=X[N](e);var Z=[ie,le],ne=[];function te(e,n){return n.justSaved?0:1}P=te(0,e),R=ne[P]=Z[P](e);var me=[de,ce],ue=[];function he(e,n){return n.$session.user?0:1}return J=he(0,e),V=ue[J]=me[J](e),{c(){n=s("div"),t=s("input"),i=o(),h=s("div"),g=s("button"),w.c(),T=o(),S=s("button"),W.$$.fragment.c(),U=o(),O=s("button"),L.c(),I=o(),D=s("button"),R.c(),C=o(),V.c(),this.h()},l(e){n=r(e,"DIV",{class:!0},!1);var s=l(n);t=r(s,"INPUT",{class:!0},!1),l(t).forEach(c),i=d(s),h=r(s,"DIV",{style:!0},!1);var a=l(h);g=r(a,"BUTTON",{class:!0,title:!0},!1);var o=l(g);w.l(o),o.forEach(c),T=d(a),S=r(a,"BUTTON",{class:!0,disabled:!0,title:!0},!1);var m=l(S);W.$$.fragment.l(m),m.forEach(c),U=d(a),O=r(a,"BUTTON",{class:!0,disabled:!0,title:!0},!1);var u=l(O);L.l(u),u.forEach(c),I=d(a),D=r(a,"BUTTON",{class:!0,disabled:!0,title:!0},!1);var p=l(D);R.l(p),p.forEach(c),C=d(a),V.l(a),a.forEach(c),s.forEach(c),this.h()},h(){m(t,"class","svelte-1ez15pl"),m(g,"class","icon svelte-1ez15pl"),m(g,"title","fullscreen editor"),m(S,"class","icon svelte-1ez15pl"),S.disabled=e.downloading,m(S,"title","download zip file"),m(O,"class","icon svelte-1ez15pl"),O.disabled=A=e.saving||!e.$session.user,m(O,"title","fork"),m(D,"class","icon svelte-1ez15pl"),D.disabled=M=e.saving||!e.$session.user,m(D,"title","save"),_(h,"text-align","right"),_(h,"margin-right",".4rem"),m(n,"class","app-controls svelte-1ez15pl"),K=[u(window,"keydown",e.handleKeydown),u(t,"input",e.input_input_handler),u(t,"focus",pe),u(g,"click",e.click_handler),u(S,"click",e.download),u(O,"click",e.click_handler_1),u(D,"click",e.save)]},m(s,o){p(s,n,o),f(n,t),b(t,e.name),a=ee.call(null,t,fe)||{},f(n,i),f(n,h),f(h,g),q[$].m(g,null),f(h,T),f(h,S),k(W,S,null),f(h,U),f(h,O),Y[N].m(O,null),f(h,I),f(h,D),ne[P].m(D,null),f(h,C),ue[J].m(h,null),F=!0},p(e,n){e.name&&t.value!==n.name&&b(t,n.name);var s=$;($=G(0,n))!==s&&(y(),z(q[s],1,1,()=>{q[s]=null}),j(),(w=q[$])||(w=q[$]=H[$](n)).c(),E(w,1),w.m(g,null)),F&&!e.downloading||(S.disabled=n.downloading);var a=N;(N=Q(0,n))!==a&&(y(),z(Y[a],1,1,()=>{Y[a]=null}),j(),(L=Y[N])||(L=Y[N]=X[N](n)).c(),E(L,1),L.m(O,null)),F&&!e.saving&&!e.$session||A===(A=n.saving||!n.$session.user)||(O.disabled=A);var o=P;(P=te(0,n))!==o&&(y(),z(ne[o],1,1,()=>{ne[o]=null}),j(),(R=ne[P])||(R=ne[P]=Z[P](n)).c(),E(R,1),R.m(D,null)),F&&!e.saving&&!e.$session||M===(M=n.saving||!n.$session.user)||(D.disabled=M);var r=J;(J=he(0,n))!==r&&(y(),z(ue[r],1,1,()=>{ue[r]=null}),j(),(V=ue[J])||(V=ue[J]=me[J](n)).c(),E(V,1),V.m(h,null))},i(e){F||(E(w),E(W.$$.fragment,e),E(L),E(R),E(V),F=!0)},o(e){z(w),z(W.$$.fragment,e),z(L),z(R),z(V),F=!1},d(e){e&&c(n),a&&"function"==typeof a.destroy&&a.destroy(),q[$].d(),x(W),Y[N].d(),ne[P].d(),ue[J].d(),v(K)}}}function ue(e){return new Promise(n=>setTimeout(n,e))}const pe=e=>e.target.select(),fe=e=>e.target.blur();function he(e,n,t){let s;const a=S(),{session:o}=R();$(e,o,e=>{t("$session",s=e)});const{login:r}=w("app");let{repl:l,gist:i,name:c,zen_mode:d,bundle:m}=n,u=!1,p=!1,f=!1,h=!1;async function g(e){t("saving",u=!0);const{components:n}=l.toJSON();try{const s=await fetch("repl/create.json",{method:"POST",credentials:"include",body:JSON.stringify({name:c,files:n.map(e=>({name:`${e.name}.${e.type}`,source:e.source}))})});if(s.status<200||s.status>=300){const{error:e}=await s.json();throw new Error(`Received an HTTP ${s.status} response: ${e}`)}const o=await s.json();a("forked",{gist:o}),e?(t("justSaved",f=!0),await ue(600),t("justSaved",f=!1)):(t("justForked",h=!0),await ue(600),t("justForked",h=!1))}catch(e){navigator.onLine?alert(e.message):alert("It looks like you're offline! Find the internet and try again")}t("saving",u=!1)}async function v(){if(!u)if(_){t("saving",u=!0);try{const{components:e}=l.toJSON(),n=await fetch(`repl/${i.uid}.json`,{method:"PATCH",credentials:"include",body:JSON.stringify({name:c,files:e.map(e=>({name:`${e.name}.${e.type}`,source:e.source}))})});if(n.status<200||n.status>=300){const{error:e}=await n.json();throw new Error(`Received an HTTP ${n.status} response: ${e}`)}await n.json(),t("justSaved",f=!0),await ue(600),t("justSaved",f=!1)}catch(e){navigator.onLine?alert(e.message):alert("It looks like you're offline! Find the internet and try again")}t("saving",u=!1)}else g(!0)}let _;return e.$set=e=>{"repl"in e&&t("repl",l=e.repl),"gist"in e&&t("gist",i=e.gist),"name"in e&&t("name",c=e.name),"zen_mode"in e&&t("zen_mode",d=e.zen_mode),"bundle"in e&&t("bundle",m=e.bundle)},e.$$.update=(e={$session:1,gist:1})=>{(e.$session||e.gist)&&(_=s.user&&i&&i.owner===s.user.uid)},{session:o,login:r,repl:l,gist:i,name:c,zen_mode:d,bundle:m,saving:u,downloading:p,justSaved:f,justForked:h,handleKeydown:function(e){83===e.which&&(te?e.metaKey:e.ctrlKey)&&(e.preventDefault(),v())},fork:g,save:v,download:async function(){t("downloading",p=!0);const{components:e,imports:n}=l.toJSON(),s=await(await fetch("/svelte-app.json")).json();if(n.length>0){const e=s.findIndex(({path:e})=>"package.json"===e),t=JSON.parse(s[e].data),{devDependencies:a}=t;n.forEach(e=>{const n=/^(@[^\/]+\/)?[^@\/]+/.exec(e);a[n[0]]="latest"}),t.devDependencies=a,s[e].data=JSON.stringify(t,null,"  ")}s.push(...e.map(e=>({path:`src/${e.name}.${e.type}`,data:e.source}))),s.push({path:"src/main.js",data:"import App from './App.svelte';\n\nvar app = new App({\n\ttarget: document.body\n});\n\nexport default app;"}),Z(Q(s),"svelte-app.zip"),t("downloading",p=!1)},$session:s,input_input_handler:function(){c=this.value,t("name",c)},click_handler:()=>t("zen_mode",d=!d),click_handler_1:()=>g(!1)}}class ge extends e{constructor(e){super(),n(this,e,he,me,t,["repl","gist","name","zen_mode","bundle"])}}const{window:ve}=A;function $e(e){var n,t;function s(t){e.inputoutputtoggle_checked_binding.call(null,t),n=!0,P(()=>n=!1)}let a={};void 0!==e.checked&&(a.checked=e.checked);var o=new J({props:a});return I.push(()=>D(o,"checked",s)),{c(){o.$$.fragment.c()},l(e){o.$$.fragment.l(e)},m(e,n){k(o,e,n),t=!0},p(e,t){var s={};!n&&e.checked&&(s.checked=t.checked),o.$set(s)},i(e){t||(E(o.$$.fragment,e),t=!0)},o(e){z(o.$$.fragment,e),t=!1},d(e){x(o,e)}}}function we(e){var n,t,a,i,h,g,v,$,w,_,b,T;function S(n){e.appcontrols_name_binding.call(null,n),v=!0,P(()=>v=!1)}function L(n){e.appcontrols_zen_mode_binding.call(null,n),$=!0,P(()=>$=!1)}U(e.onwindowresize),document.title=n=e.name+" • REPL • Svelte";let A={gist:e.gist,repl:e.repl};void 0!==e.name&&(A.name=e.name),void 0!==e.zen_mode&&(A.zen_mode=e.zen_mode);var R=new ge({props:A});I.push(()=>D(R,"name",S)),I.push(()=>D(R,"zen_mode",L)),R.$on("forked",e.handle_fork);var M=function(e){var n,t,a,i;let u={workersUrl:"workers",svelteUrl:e.svelteUrl,rollupUrl:e.rollupUrl,relaxed:e.relaxed,fixed:e.mobile,injectedJS:e.mapbox_setup};var f=new C({props:u});e.repl_1_binding(f);var h=e.mobile&&$e(e);return{c(){n=s("div"),f.$$.fragment.c(),t=o(),h&&h.c(),a=O(),this.h()},l(e){n=r(e,"DIV",{class:!0},!1);var s=l(n);f.$$.fragment.l(s),s.forEach(c),t=d(e),h&&h.l(e),a=O(),this.h()},h(){m(n,"class","viewport svelte-1jnlh7l"),N(n,"offset",e.checked)},m(e,s){p(e,n,s),k(f,n,null),p(e,t,s),h&&h.m(e,s),p(e,a,s),i=!0},p(e,t){var s={};e.svelteUrl&&(s.svelteUrl=t.svelteUrl),e.relaxed&&(s.relaxed=t.relaxed),e.mobile&&(s.fixed=t.mobile),f.$set(s),e.checked&&N(n,"offset",t.checked),t.mobile?h?(h.p(e,t),E(h,1)):((h=$e(t)).c(),E(h,1),h.m(a.parentNode,a)):h&&(y(),z(h,1,1,()=>{h=null}),j())},i(e){i||(E(f.$$.fragment,e),E(h),i=!0)},o(e){z(f.$$.fragment,e),z(h),i=!1},d(s){s&&c(n),e.repl_1_binding(null),x(f),s&&c(t),h&&h.d(s),s&&c(a)}}}(e);return{c(){t=s("meta"),a=s("meta"),i=s("meta"),h=o(),g=s("div"),R.$$.fragment.c(),w=o(),M&&M.c(),this.h()},l(e){t=r(e,"META",{name:!0,content:!0},!1),l(t).forEach(c),a=r(e,"META",{name:!0,content:!0},!1),l(a).forEach(c),i=r(e,"META",{name:!0,content:!0},!1),l(i).forEach(c),h=d(e),g=r(e,"DIV",{class:!0},!1);var n=l(g);R.$$.fragment.l(n),w=d(n),M&&M.l(n),n.forEach(c),this.h()},h(){m(t,"name","twitter:title"),m(t,"content","Svelte REPL"),m(a,"name","twitter:description"),m(a,"content","Cybernetically enhanced web apps"),m(i,"name","Description"),m(i,"content","Interactive Svelte playground"),m(g,"class",_="repl-outer "+(e.zen_mode?"zen-mode":"")+" svelte-1jnlh7l"),N(g,"mobile",e.mobile),T=u(ve,"resize",e.onwindowresize)},m(e,n){f(document.head,t),f(document.head,a),f(document.head,i),p(e,h,n),p(e,g,n),k(R,g,null),f(g,w),M&&M.m(g,null),b=!0},p(e,t){b&&!e.name||n===(n=t.name+" • REPL • Svelte")||(document.title=n);var s={};e.gist&&(s.gist=t.gist),e.repl&&(s.repl=t.repl),!v&&e.name&&(s.name=t.name),!$&&e.zen_mode&&(s.zen_mode=t.zen_mode),R.$set(s),M.p(e,t),b&&!e.zen_mode||_===(_="repl-outer "+(t.zen_mode?"zen-mode":"")+" svelte-1jnlh7l")||m(g,"class",_),(e.zen_mode||e.mobile)&&N(g,"mobile",t.mobile)},i(e){b||(E(R.$$.fragment,e),E(M),b=!0)},o(e){z(R.$$.fragment,e),z(M),b=!1},d(e){c(t),c(a),c(i),e&&(c(h),c(g)),x(R),M&&M.d(),T()}}}function _e({params:e,query:n}){return{version:n.version||"3",id:e.id}}function be(e,n,t){let s,{version:a,id:o}=n;const{session:r}=R();let l,i;$(e,r,e=>{t("$session",s=e)});let c="Loading...",d=!1,m=!1,u=window.innerWidth,p=!1;L(()=>{"local"!==a&&fetch(`https://unpkg.com/svelte@${a||"3"}/package.json`).then(e=>e.json()).then(e=>{t("version",a=e.version)})});let f,h,g;return e.$set=e=>{"version"in e&&t("version",a=e.version),"id"in e&&t("id",o=e.id)},e.$$.update=(e={version:1,id:1,width:1,is_relaxed_gist:1,$session:1,gist:1})=>{e.version&&"undefined"!=typeof history&&function(e){const n=[];"latest"!==e&&n.push(`version=${e}`);const t=n.length>0?`repl/${o}?${n.join("&")}`:`repl/${o}`;history.replaceState({},"x",t)}(a),e.id&&function(e){i&&i.uid===e||fetch(`repl/${e}.json`).then(e=>{e.ok?e.json().then(e=>{t("gist",i=e),t("name",c=e.name),t("is_relaxed_gist",m=e.relaxed);const n=e.files.map(e=>{let[n,t]=e.name.split(".");return"html"===t&&(t="svelte"),{name:n,type:t,source:e.source}});n.sort((e,n)=>"App"===e.name&&"svelte"===e.type?-1:"App"===n.name&&"svelte"===n.type?1:e.type!==n.type?"svelte"===e.type?-1:1:e.name<n.name?-1:1),l.set({components:n})}):console.warn("TODO: 404 Gist")})}(o),e.version&&t("svelteUrl",f="local"===a?`${location.origin}/repl/local`:`https://unpkg.com/svelte@${a}`),e.width&&t("mobile",h=u<540),(e.is_relaxed_gist||e.$session||e.gist)&&t("relaxed",g=m||s.user&&i&&s.user.uid===i.owner)},{version:a,id:o,session:r,repl:l,gist:i,name:c,zen_mode:d,width:u,checked:p,handle_fork:function(e){console.log("> handle_fork",e),t("gist",i=e.detail.gist),M(`/repl/${i.uid}?version=${a}`)},rollupUrl:"https://unpkg.com/rollup@1/dist/rollup.browser.js",mapbox_setup:"window.MAPBOX_ACCESS_TOKEN = undefined;",svelteUrl:f,mobile:h,relaxed:g,onwindowresize:function(){u=ve.innerWidth,t("width",u)},appcontrols_name_binding:function(e){t("name",c=e)},appcontrols_zen_mode_binding:function(e){t("zen_mode",d=e)},repl_1_binding:function(e){I[e?"unshift":"push"](()=>{t("repl",l=e)})},inputoutputtoggle_checked_binding:function(e){t("checked",p=e)}}}export default class extends e{constructor(e){super(),n(this,e,be,we,t,["version","id"])}}export{_e as preload};
