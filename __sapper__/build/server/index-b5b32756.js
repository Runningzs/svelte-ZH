'use strict';

var index = require('./index-eb65fe33.js');

/* src\routes\apps\index.svelte generated by Svelte v3.12.0 */

const css = {
	code: ".apps.svelte-2bannn{padding:var(--top-offset) var(--side-nav) 6rem var(--side-nav);max-width:var(--main-width);margin:0 auto}header.svelte-2bannn{margin:0 0 1em 0}h1.svelte-2bannn{font-size:4rem;font-weight:400}.user.svelte-2bannn{display:flex;padding:0 0 0 3.2rem;position:relative;margin:1rem 0 5rem 0;color:var(--text)}.avatar.svelte-2bannn{position:absolute;left:0;top:0.1rem;width:2.4rem;height:2.4rem;border:1px solid rgba(0,0,0,0.3);border-radius:0.2rem}ul.svelte-2bannn{list-style:none}li.svelte-2bannn{margin:0 0 1em 0}h2.svelte-2bannn{color:var(--text);font-size:var(--h3);font-weight:400}li.svelte-2bannn a.svelte-2bannn{border:none}li.svelte-2bannn a:hover h2.svelte-2bannn{color:var(--flash)}li.svelte-2bannn span.svelte-2bannn{font-size:14px;color:#999}",
	map: "{\"version\":3,\"file\":\"index.svelte\",\"sources\":[\"index.svelte\"],\"sourcesContent\":[\"<script context=\\\"module\\\">\\r\\n\\texport async function preload(page, { user }) {\\r\\n\\t\\tlet apps = [];\\r\\n\\t\\tlet offset = null;\\r\\n\\r\\n\\t\\tif (user) {\\r\\n\\t\\t\\tlet url = 'apps.json';\\r\\n\\t\\t\\tif (page.query.offset) {\\r\\n\\t\\t\\t\\turl += `?offset=${encodeURIComponent(page.query.offset)}`;\\r\\n\\t\\t\\t}\\r\\n\\t\\t\\tconst r = await this.fetch(url, {\\r\\n\\t\\t\\t\\tcredentials: 'include'\\r\\n\\t\\t\\t});\\r\\n\\t\\t\\tif (!r.ok) return this.error(r.status, await r.text());\\r\\n\\r\\n\\t\\t\\t({ apps, offset } = await r.json());\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\treturn { user, apps, offset };\\r\\n\\t}\\r\\n</script>\\r\\n\\r\\n<script>\\r\\n\\timport { getContext } from 'svelte';\\r\\n\\r\\n\\texport let user;\\r\\n\\texport let apps;\\r\\n\\texport let offset;\\r\\n\\r\\n\\tconst { login, logout } = getContext('app');\\r\\n\\r\\n\\tconst formatter = new Intl.DateTimeFormat(undefined, {\\r\\n\\t\\tyear: 'numeric',\\r\\n\\t\\tmonth: 'short',\\r\\n\\t\\tday: 'numeric',\\r\\n\\t\\thour: 'numeric',\\r\\n\\t\\tminute: '2-digit'\\r\\n\\t});\\r\\n\\r\\n\\tconst format = str => formatter.format(new Date(str));\\r\\n</script>\\r\\n\\r\\n<svelte:head>\\r\\n\\t<title>Your apps • Svelte</title>\\r\\n</svelte:head>\\r\\n\\r\\n<div class=\\\"apps\\\">\\r\\n\\t{#if user}\\r\\n\\t\\t<header>\\r\\n\\t\\t\\t<h1>Your apps</h1>\\r\\n\\r\\n\\t\\t\\t<div class=\\\"user\\\">\\r\\n\\t\\t\\t\\t<img class=\\\"avatar\\\" alt=\\\"{user.name || user.username} avatar\\\" src=\\\"{user.avatar}\\\">\\r\\n\\t\\t\\t\\t<span>\\r\\n\\t\\t\\t\\t\\t{user.name || user.username}\\r\\n\\t\\t\\t\\t\\t(<a on:click|preventDefault={logout} href=\\\"auth/logout\\\">log out</a>)\\r\\n\\t\\t\\t\\t</span>\\r\\n\\t\\t\\t</div>\\r\\n\\t\\t</header>\\r\\n\\r\\n\\t\\t<ul>\\r\\n\\t\\t\\t{#each apps as app}\\r\\n\\t\\t\\t\\t<li>\\r\\n\\t\\t\\t\\t\\t<a href=\\\"repl/{app.uid}\\\">\\r\\n\\t\\t\\t\\t\\t\\t<h2>{app.name}</h2>\\r\\n\\t\\t\\t\\t\\t\\t<span>updated {format(app.updated_at)}</span>\\r\\n\\t\\t\\t\\t\\t</a>\\r\\n\\t\\t\\t\\t</li>\\r\\n\\t\\t\\t{/each}\\r\\n\\t\\t</ul>\\r\\n\\r\\n\\t\\t{#if offset !== null}\\r\\n\\t\\t\\t<div><a href=\\\"apps?offset={offset}\\\">Next page...</a></div>\\r\\n\\t\\t{/if}\\r\\n\\t{:else}\\r\\n\\t\\t<p>Please <a on:click|preventDefault={login} href=\\\"auth/login\\\">log in</a> to see your saved apps.</p>\\r\\n\\t{/if}\\r\\n</div>\\r\\n\\r\\n<style>\\r\\n\\t.apps {\\r\\n\\t\\tpadding: var(--top-offset) var(--side-nav) 6rem var(--side-nav);\\r\\n\\t\\tmax-width: var(--main-width);\\r\\n\\t\\tmargin: 0 auto;\\r\\n\\t}\\r\\n\\r\\n\\theader {\\r\\n\\t\\tmargin: 0 0 1em 0;\\r\\n\\t}\\r\\n\\r\\n\\th1 {\\r\\n\\t\\tfont-size: 4rem;\\r\\n\\t\\tfont-weight: 400;\\r\\n\\t}\\r\\n\\r\\n\\t.user {\\r\\n\\t\\tdisplay: flex;\\r\\n\\t\\tpadding: 0 0 0 3.2rem;\\r\\n\\t\\tposition: relative;\\r\\n\\t\\tmargin: 1rem 0 5rem 0;\\r\\n\\t\\tcolor: var(--text);\\r\\n\\t}\\r\\n\\r\\n\\t.avatar {\\r\\n\\t\\tposition: absolute;\\r\\n\\t\\tleft: 0;\\r\\n\\t\\ttop: 0.1rem;\\r\\n\\t\\twidth: 2.4rem;\\r\\n\\t\\theight: 2.4rem;\\r\\n\\t\\tborder: 1px solid rgba(0,0,0,0.3);\\r\\n\\t\\tborder-radius: 0.2rem;\\r\\n\\t}\\r\\n\\r\\n\\tul {\\r\\n\\t\\tlist-style: none;\\r\\n\\t}\\r\\n\\r\\n\\tli {\\r\\n\\t\\tmargin: 0 0 1em 0;\\r\\n\\t}\\r\\n\\r\\n\\th2 {\\r\\n\\t\\tcolor: var(--text);\\r\\n\\t\\tfont-size: var(--h3);\\r\\n\\t\\tfont-weight: 400;\\r\\n\\t}\\r\\n\\r\\n\\tli a {\\r\\n\\t\\tborder: none;\\r\\n\\t}\\r\\n\\r\\n\\tli a:hover h2 {\\r\\n\\t\\tcolor: var(--flash);\\r\\n\\t}\\r\\n\\r\\n\\tli span {\\r\\n\\t\\tfont-size: 14px;\\r\\n\\t\\tcolor: #999;\\r\\n\\t}\\r\\n</style>\\r\\n\"],\"names\":[],\"mappings\":\"AAgFC,KAAK,cAAC,CAAC,AACN,OAAO,CAAE,IAAI,YAAY,CAAC,CAAC,IAAI,UAAU,CAAC,CAAC,IAAI,CAAC,IAAI,UAAU,CAAC,CAC/D,SAAS,CAAE,IAAI,YAAY,CAAC,CAC5B,MAAM,CAAE,CAAC,CAAC,IAAI,AACf,CAAC,AAED,MAAM,cAAC,CAAC,AACP,MAAM,CAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,AAClB,CAAC,AAED,EAAE,cAAC,CAAC,AACH,SAAS,CAAE,IAAI,CACf,WAAW,CAAE,GAAG,AACjB,CAAC,AAED,KAAK,cAAC,CAAC,AACN,OAAO,CAAE,IAAI,CACb,OAAO,CAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CACrB,QAAQ,CAAE,QAAQ,CAClB,MAAM,CAAE,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CACrB,KAAK,CAAE,IAAI,MAAM,CAAC,AACnB,CAAC,AAED,OAAO,cAAC,CAAC,AACR,QAAQ,CAAE,QAAQ,CAClB,IAAI,CAAE,CAAC,CACP,GAAG,CAAE,MAAM,CACX,KAAK,CAAE,MAAM,CACb,MAAM,CAAE,MAAM,CACd,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CACjC,aAAa,CAAE,MAAM,AACtB,CAAC,AAED,EAAE,cAAC,CAAC,AACH,UAAU,CAAE,IAAI,AACjB,CAAC,AAED,EAAE,cAAC,CAAC,AACH,MAAM,CAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,AAClB,CAAC,AAED,EAAE,cAAC,CAAC,AACH,KAAK,CAAE,IAAI,MAAM,CAAC,CAClB,SAAS,CAAE,IAAI,IAAI,CAAC,CACpB,WAAW,CAAE,GAAG,AACjB,CAAC,AAED,gBAAE,CAAC,CAAC,cAAC,CAAC,AACL,MAAM,CAAE,IAAI,AACb,CAAC,AAED,gBAAE,CAAC,CAAC,MAAM,CAAC,EAAE,cAAC,CAAC,AACd,KAAK,CAAE,IAAI,OAAO,CAAC,AACpB,CAAC,AAED,gBAAE,CAAC,IAAI,cAAC,CAAC,AACR,SAAS,CAAE,IAAI,CACf,KAAK,CAAE,IAAI,AACZ,CAAC\"}"
};

async function preload(page, { user }) {
	let apps = [];
	let offset = null;

	if (user) {
		let url = 'apps.json';
		if (page.query.offset) {
			url += `?offset=${encodeURIComponent(page.query.offset)}`;
		}
		const r = await this.fetch(url, {
			credentials: 'include'
		});
		if (!r.ok) return this.error(r.status, await r.text());

		({ apps, offset } = await r.json());
	}

	return { user, apps, offset };
}

const Index = index.create_ssr_component(($$result, $$props, $$bindings, $$slots) => {
	let { user, apps, offset } = $$props;

	const { login, logout } = index.getContext('app');

	const formatter = new Intl.DateTimeFormat(undefined, {
		year: 'numeric',
		month: 'short',
		day: 'numeric',
		hour: 'numeric',
		minute: '2-digit'
	});

	const format = str => formatter.format(new Date(str));

	if ($$props.user === void 0 && $$bindings.user && user !== void 0) $$bindings.user(user);
	if ($$props.apps === void 0 && $$bindings.apps && apps !== void 0) $$bindings.apps(apps);
	if ($$props.offset === void 0 && $$bindings.offset && offset !== void 0) $$bindings.offset(offset);

	$$result.css.add(css);

	return `${($$result.head += `<title>Your apps • Svelte</title>`, "")}

	<div class="apps svelte-2bannn">
		${ user ? `<header class="svelte-2bannn">
				<h1 class="svelte-2bannn">Your apps</h1>

				<div class="user svelte-2bannn">
					<img class="avatar svelte-2bannn" alt="${index.escape(user.name || user.username)} avatar"${index.add_attribute("src", user.avatar, 0)}>
					<span>
						${index.escape(user.name || user.username)}
						(<a href="auth/logout">log out</a>)
					</span>
				</div>
			</header>

			<ul class="svelte-2bannn">
				${index.each(apps, (app) => `<li class="svelte-2bannn">
						<a href="repl/${index.escape(app.uid)}" class="svelte-2bannn">
							<h2 class="svelte-2bannn">${index.escape(app.name)}</h2>
							<span class="svelte-2bannn">updated ${index.escape(format(app.updated_at))}</span>
						</a>
					</li>`)}
			</ul>

			${ offset !== null ? `<div><a href="apps?offset=${index.escape(offset)}">Next page...</a></div>` : `` }` : `<p>Please <a href="auth/login">log in</a> to see your saved apps.</p>` }
	</div>`;
});

exports.default = Index;
exports.preload = preload;
